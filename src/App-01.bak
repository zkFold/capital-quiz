import React, { useState } from 'react';
import './App.css';
import { entries } from './data';

type Question = {
  country: string;
  userAnswer: string;
};

const shuffle = <T,>(array: T[]): T[] => {
  return [...array].sort(() => Math.random() - 0.5);
};

function App() {
  const [questions, setQuestions] = useState<Question[]>([]);
  const [capitalList] = useState(() => shuffle(entries.map(e => e.capital)));

  const generateQuestions = () => {
    const picked = shuffle(entries).slice(0, 5);
    setQuestions(picked.map(({ country }) => ({ country, userAnswer: '' })));
  };

  const handleChange = (index: number, value: string) => {
    setQuestions(prev =>
      prev.map((q, i) => (i === index ? { ...q, userAnswer: value } : q))
    );
  };

  const handleSubmit = async () => {
    const payload = questions.map(q => ({
      country: q.country,
      answer: q.userAnswer,
    }));

    try {
      await fetch('http://localhost:3000/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      alert('Submitted!');
    } catch (err) {
      alert('Error submitting answers');
    }
  };

  return (
    <div style={{ padding: '2rem' }}>
      <h1>Capital Cities Quiz</h1>
      <button onClick={generateQuestions}>Generate Questions</button>

      {questions.map((q, i) => (
        <div key={i} style={{ display: 'flex', marginLeft: '10rem', marginTop: '1rem' }}>
          <div style={{ width: '200px' }}>{q.country}</div>
          <input
            type="number"
            value={q.userAnswer}
            onChange={(e) => handleChange(i, e.target.value)}
          />
        </div>
      ))}

      {questions.length > 0 && (
        <button style={{ marginTop: '1rem' }} onClick={handleSubmit}>
          Submit
        </button>
      )}

      <h2 style={{ marginTop: '3rem' }}>Capital Cities List</h2>
      <ol
	style={{
	  display: 'grid',
	  gridTemplateColumns: '1fr 1fr 1fr 1fr 1fr',
	  gap: '0.5rem 2rem',
	  listStylePosition: 'inside',
	  paddingLeft: 0,
	}}
      >
	{capitalList.map((capital, index) => (
	  <li key={index}>{capital}</li>
	))}
      </ol>
    </div>
  );
}

export default App;
